import{r as e,a as s,b as t}from"./vendor-51280515.js";import{u as a,a as r,L as l,N as n,R as i,b as d,B as c}from"./router-902ffa71.js";import{a as o}from"./utils-63a63872.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var m={exports:{}},x={},u=e,h=Symbol.for("react.element"),g=Symbol.for("react.fragment"),p=Object.prototype.hasOwnProperty,y=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,v={key:!0,ref:!0,__self:!0,__source:!0};function j(e,s,t){var a,r={},l=null,n=null;for(a in void 0!==t&&(l=""+t),void 0!==s.key&&(l=""+s.key),void 0!==s.ref&&(n=s.ref),s)p.call(s,a)&&!v.hasOwnProperty(a)&&(r[a]=s[a]);if(e&&e.defaultProps)for(a in s=e.defaultProps)void 0===r[a]&&(r[a]=s[a]);return{$$typeof:h,type:e,key:l,ref:n,props:r,_owner:y.current}}x.Fragment=g,x.jsx=j,x.jsxs=j,m.exports=x;var f=m.exports,b={},N=s;b.createRoot=N.createRoot,b.hydrateRoot=N.hydrateRoot;const w=o.create({baseURL:"https://test-crm.brianaldybramasta.my.id/api",timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});w.interceptors.request.use(e=>{const s=localStorage.getItem("token");return s&&(e.headers.Authorization=`Bearer ${s}`),e},e=>Promise.reject(e)),w.interceptors.response.use(e=>e,e=>{var s;return 401===(null==(s=e.response)?void 0:s.status)&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});const k={async login(e,s){var t,a;try{const t=await w.post("/auth/login",{email:e,password:s}),{token:a,user:r,permissions:l}=t.data;return localStorage.setItem("token",a),localStorage.setItem("user",JSON.stringify({...r,permissions:l})),{success:!0,data:{token:a,user:{...r,permissions:l}}}}catch(r){return{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"Login failed"}}},async logout(){try{await w.post("/auth/logout")}catch(e){}finally{localStorage.removeItem("token"),localStorage.removeItem("user")}},async getCurrentUser(){var e,s;try{const e=await w.get("/user"),{user:s,permissions:t,stats:a}=e.data,r={...s,permissions:t,stats:a};return localStorage.setItem("user",JSON.stringify(r)),{success:!0,data:r}}catch(t){return{success:!1,error:(null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||"Failed to get user"}}},async updateProfile(e){var s,t;try{const s=await w.put("/user/profile",e),{user:t}=s.data,a={...this.getStoredUser(),...t};return localStorage.setItem("user",JSON.stringify(a)),{success:!0,data:a}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to update profile"}}},getStoredToken:()=>localStorage.getItem("token"),getStoredUser(){const e=localStorage.getItem("user");return e?JSON.parse(e):null},isAuthenticated(){return!!this.getStoredToken()},hasPermission(e){var s;const t=this.getStoredUser();return(null==(s=null==t?void 0:t.permissions)?void 0:s[e])||!1},isSales(){const e=this.getStoredUser();return"sales"===(null==e?void 0:e.role)},isManager(){const e=this.getStoredUser();return"manager"===(null==e?void 0:e.role)}},_=e.createContext(),C=()=>{const s=e.useContext(_);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},S=({children:s})=>{const[t,a]=e.useState(null),[r,l]=e.useState(!0),[n,i]=e.useState(!1);e.useEffect(()=>{(async()=>{const e=k.getStoredToken(),s=k.getStoredUser();if(e&&s){const e=await k.getCurrentUser();e.success?(a(e.data),i(!0)):(await k.logout(),a(null),i(!1))}l(!1)})()},[]);const d={user:t,loading:r,isAuthenticated:n,login:async(e,s)=>{l(!0);try{const t=await k.login(e,s);return t.success?(a(t.data.user),i(!0),{success:!0}):{success:!1,error:t.error}}catch(t){return{success:!1,error:"Login failed"}}finally{l(!1)}},logout:async()=>{l(!0);try{await k.logout()}finally{a(null),i(!1),l(!1)}}};return f.jsx(_.Provider,{value:d,children:s})},D=()=>{var s,t;const n=a(),i=r(),{user:d,logout:c}=C(),[o,m]=e.useState(!1),x=[{name:"Dashboard",href:"/dashboard",icon:f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})})},{name:"Leads",href:"/leads",icon:f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})},{name:"Deals",href:"/deals",icon:f.jsxs("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:[f.jsx("path",{d:"M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"}),f.jsx("path",{fillRule:"evenodd",d:"M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z",clipRule:"evenodd"})]})},{name:"Customers",href:"/customers",icon:f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})})},{name:"Products",href:"/products",icon:f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M10 2L3 7v11a1 1 0 001 1h12a1 1 0 001-1V7l-7-5zM6 9.5a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm5.5 0a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z",clipRule:"evenodd"})})},{name:"Reports",href:"/reports",icon:f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{d:"M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"})})}].filter(e=>{var s;return"sales"!==(null==d?void 0:d.role)||("Reports"!==e.name||(null==(s=null==d?void 0:d.permissions)?void 0:s.can_view_reports))});return f.jsxs("div",{className:`bg-white shadow-lg h-screen ${o?"w-16":"w-64"} transition-all duration-300 ease-in-out flex flex-col`,children:[f.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[!o&&f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:f.jsx("span",{className:"text-white font-bold text-sm",children:"PS"})}),f.jsx("span",{className:"font-bold text-lg text-gray-800",children:"PT Smart CRM"})]}),f.jsx("button",{onClick:()=>m(!o),className:"p-1 rounded-md hover:bg-gray-100 transition-colors",children:f.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})})})]}),!o&&d&&f.jsx("div",{className:"p-4 border-b border-gray-200",children:f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center",children:f.jsx("span",{className:"text-gray-700 font-medium text-sm",children:null==(t=null==(s=d.name)?void 0:s.charAt(0))?void 0:t.toUpperCase()})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:d.name}),f.jsx("p",{className:"text-xs text-gray-500 capitalize",children:d.role})]})]})}),f.jsx("nav",{className:"flex-1 px-4 py-6 space-y-2",children:x.map(e=>{const s=n.pathname===e.href;return f.jsxs(l,{to:e.href,className:"group flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors "+(s?"bg-blue-50 text-blue-700 border-r-2 border-blue-700":"text-gray-700 hover:bg-gray-50 hover:text-gray-900"),children:[f.jsx("span",{className:""+(s?"text-blue-500":"text-gray-400 group-hover:text-gray-500"),children:e.icon}),!o&&f.jsx("span",{className:"ml-3",children:e.name})]},e.name)})}),f.jsx("div",{className:"p-4 border-t border-gray-200",children:f.jsxs("button",{onClick:async()=>{await c(),i("/login")},className:"group flex items-center w-full px-3 py-2 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 hover:text-gray-900 transition-colors "+(o?"justify-center":""),children:[f.jsx("svg",{className:"w-5 h-5 text-gray-400 group-hover:text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z",clipRule:"evenodd"})}),!o&&f.jsx("span",{className:"ml-3",children:"Logout"})]})})]})},M=({children:e})=>{const{isAuthenticated:s}=C();return s?f.jsxs("div",{className:"flex h-screen bg-gray-50",children:[f.jsx(D,{}),f.jsx("main",{className:"flex-1 overflow-hidden",children:f.jsx("div",{className:"h-full overflow-y-auto",children:f.jsx("div",{className:"p-6",children:e})})})]}):f.jsx("div",{className:"min-h-screen bg-gray-50",children:f.jsx("main",{children:e})})},P=({children:e})=>{const{isAuthenticated:s,loading:t}=C(),r=a();return t?f.jsx("div",{className:"min-h-screen flex items-center justify-center",children:f.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600"})}):s?e:f.jsx(n,{to:"/login",state:{from:r},replace:!0})};var F={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};var R=(s,t)=>{const a=e.forwardRef(({color:a="currentColor",size:r=24,strokeWidth:l=2,absoluteStrokeWidth:n,children:i,...d},c)=>{return e.createElement("svg",{ref:c,...F,width:r,height:r,stroke:a,strokeWidth:n?24*Number(l)/Number(r):l,className:`lucide lucide-${o=s,o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,...d},[...t.map(([s,t])=>e.createElement(s,t)),...(Array.isArray(i)?i:[i])||[]]);var o});return a.displayName=`${s}`,a};const z=R("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),A=R("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),I=R("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),q=R("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),L=R("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),E=R("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),T=R("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),$=R("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),U=R("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),H=R("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),O=R("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),V=R("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),B=R("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),W=R("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Y=R("Package",[["path",{d:"M16.5 9.4 7.55 4.24",key:"10qotr"}],["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),G=R("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),Q=R("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Z=R("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),J=R("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),K=R("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),X=R("Signal",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]]),ee=R("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),se=R("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),te=R("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),ae=R("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),re=R("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),le=R("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),ne=R("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),ie=R("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),de=()=>{var s,t;const[n,i]=e.useState(""),[d,c]=e.useState(""),[o,m]=e.useState(""),[x,u]=e.useState(!1),{login:h,isAuthenticated:g}=C(),p=r(),y=(null==(t=null==(s=a().state)?void 0:s.from)?void 0:t.pathname)||"/dashboard";e.useEffect(()=>{g&&p(y,{replace:!0})},[g,p,y]);return f.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:f.jsxs("div",{className:"max-w-md w-full space-y-8",children:[f.jsxs("div",{children:[f.jsx("div",{className:"mx-auto h-12 w-auto flex justify-center",children:f.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"PT Smart CRM"})}),f.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Sign in to your account"}),f.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Or"," ",f.jsx(l,{to:"/",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"go back to home page"})]})]}),f.jsxs("form",{className:"mt-8 space-y-6",onSubmit:async e=>{e.preventDefault(),m(""),u(!0);const s=await h(n,d);s.success?p(y,{replace:!0}):m(s.error||"Login failed"),u(!1)},children:[o&&f.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:o}),f.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[f.jsxs("div",{children:[f.jsx("label",{htmlFor:"email-address",className:"sr-only",children:"Email address"}),f.jsx("input",{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Email address",value:n,onChange:e=>i(e.target.value)})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),f.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Password",value:d,onChange:e=>c(e.target.value)})]})]}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center",children:[f.jsx("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),f.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-900",children:"Remember me"})]}),f.jsx("div",{className:"text-sm",children:f.jsx("a",{href:"#",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"Forgot your password?"})})]}),f.jsx("div",{children:f.jsx("button",{type:"submit",disabled:x,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Signing in...":"Sign in"})}),f.jsxs("div",{className:"mt-6",children:[f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"absolute inset-0 flex items-center",children:f.jsx("div",{className:"w-full border-t border-gray-300"})}),f.jsx("div",{className:"relative flex justify-center text-sm",children:f.jsx("span",{className:"px-2 bg-gray-50 text-gray-500",children:"Demo Mode"})})]}),f.jsx("div",{className:"mt-6",children:f.jsx(l,{to:"/dashboard",className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-500 bg-white hover:bg-gray-50 transition duration-200",children:"Continue to Dashboard (Demo)"})})]})]})]})})},ce=({size:e="md",text:s="Loading..."})=>f.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[f.jsx("div",{className:`animate-spin rounded-full border-b-2 border-indigo-600 ${{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12",xl:"h-16 w-16"}[e]}`}),s&&f.jsx("p",{className:"text-sm text-gray-500",children:s})]}),oe=({message:e,onClose:s,className:t=""})=>e?f.jsx("div",{className:`bg-red-50 border border-red-200 rounded-md p-4 ${t}`,children:f.jsxs("div",{className:"flex",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx(z,{className:"h-5 w-5 text-red-400"})}),f.jsx("div",{className:"ml-3",children:f.jsx("p",{className:"text-sm text-red-800",children:e})}),s&&f.jsx("div",{className:"ml-auto pl-3",children:f.jsx("div",{className:"-mx-1.5 -my-1.5",children:f.jsx("button",{onClick:s,className:"inline-flex bg-red-50 rounded-md p-1.5 text-red-500 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-red-50 focus:ring-red-600",children:f.jsx(ie,{className:"h-4 w-4"})})})})]})}):null,me=async(e="month",s=null)=>{var t,a;try{const t={period:e};s&&s.start&&s.end&&(t.start_date=s.start,t.end_date=s.end,delete t.period);return{success:!0,data:(await w.get("/reports/dashboard-stats",{params:t})).data}}catch(r){return{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"Failed to fetch dashboard statistics"}}},xe=async e=>{var s,t;try{return{success:!0,data:(await w.get("/reports/sales",{params:{start_date:e.startDate,end_date:e.endDate,sales_id:e.salesId}})).data}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to generate sales report"}}},ue=async e=>{var s,t;try{return{success:!0,data:(await w.get("/reports/revenue",{params:{start_date:e.startDate,end_date:e.endDate,sales_id:e.salesId}})).data}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to generate revenue report"}}},he=async(e,s)=>{var t,a;try{const t=await w.get("/reports/export",{params:{type:e,start_date:s.startDate,end_date:s.endDate,sales_id:s.salesId},responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=a;const l=`${e}_report_${(new Date).toISOString().slice(0,19).replace(/:/g,"-")}.xlsx`;return r.setAttribute("download",l),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(a),{success:!0}}catch(r){return{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"Failed to export report"}}},ge=async e=>{var s,t;try{return{success:!0,data:(await w.post("/reports/customers",e)).data}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to generate customer report"}}},pe=async()=>{var e,s;try{return{success:!0,data:(await w.get("/reports")).data}}catch(t){return{success:!1,error:(null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||"Failed to fetch reports"}}},ye=()=>{var s,t,a,r,n,i,d,c;const{user:o}=C(),[m,x]=e.useState(null),[u,h]=e.useState(!0),[g,p]=e.useState("");e.useEffect(()=>{y()},[]);const y=async()=>{h(!0);try{const e=await me();e.success?(x(e.data),p("")):p(e.error)}catch(e){p("Failed to load dashboard statistics. Please try again.")}finally{h(!1)}};return f.jsxs("div",{className:"max-w-7xl mx-auto py-6",children:[f.jsxs("div",{className:"mb-8",children:[f.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),f.jsxs("p",{className:"mt-2 text-gray-600",children:["Welcome back, ",null==o?void 0:o.name,"! Here's your PT Smart CRM overview."]})]}),g&&f.jsx("div",{className:"mb-6",children:f.jsx(oe,{message:g,onClose:()=>p("")})}),u?f.jsx("div",{className:"py-12 text-center",children:f.jsx(ce,{size:"lg",text:"Loading dashboard..."})}):m?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[f.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200",children:f.jsx("div",{className:"p-6",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx(re,{className:"h-8 w-8 text-blue-500"})}),f.jsxs("div",{className:"ml-4",children:[f.jsx("p",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide",children:"Total Leads"}),f.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.totalLeads||(null==(s=null==o?void 0:o.stats)?void 0:s.total_leads)||0})]})]})})}),f.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200",children:f.jsx("div",{className:"p-6",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx(I,{className:"h-8 w-8 text-green-500"})}),f.jsxs("div",{className:"ml-4",children:[f.jsx("p",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide",children:"Total Deals"}),f.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.totalDeals||(null==(t=null==o?void 0:o.stats)?void 0:t.total_deals)||0})]})]})})}),f.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200",children:f.jsx("div",{className:"p-6",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx(q,{className:"h-8 w-8 text-purple-500"})}),f.jsxs("div",{className:"ml-4",children:[f.jsx("p",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide",children:"Total Customers"}),f.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.totalCustomers||(null==(a=null==o?void 0:o.stats)?void 0:a.total_customers)||0})]})]})})}),f.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200",children:f.jsx("div",{className:"p-6",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx($,{className:"h-8 w-8 text-yellow-500"})}),f.jsxs("div",{className:"ml-4",children:[f.jsx("p",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide",children:"This Month Revenue"}),f.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(v=m.totalRevenue||(null==(r=null==o?void 0:o.stats)?void 0:r.this_month_revenue)||0,v?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,notation:"compact",compactDisplay:"short"}).format(v):"Rp 0")})]})]})})})]}),"sales"===(null==o?void 0:o.role)&&f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[f.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 overflow-hidden shadow-sm rounded-lg",children:f.jsx("div",{className:"p-6 text-white",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx(se,{className:"h-8 w-8"}),f.jsxs("div",{className:"ml-4",children:[f.jsx("p",{className:"text-blue-100",children:"Qualified Leads"}),f.jsx("p",{className:"text-2xl font-bold",children:(null==(n=null==o?void 0:o.stats)?void 0:n.qualified_leads)||0})]})]})})}),f.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 overflow-hidden shadow-sm rounded-lg",children:f.jsx("div",{className:"p-6 text-white",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx(I,{className:"h-8 w-8"}),f.jsxs("div",{className:"ml-4",children:[f.jsx("p",{className:"text-green-100",children:"Won Deals"}),f.jsx("p",{className:"text-2xl font-bold",children:(null==(i=null==o?void 0:o.stats)?void 0:i.won_deals)||0})]})]})})}),f.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 overflow-hidden shadow-sm rounded-lg",children:f.jsx("div",{className:"p-6 text-white",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx(q,{className:"h-8 w-8"}),f.jsxs("div",{className:"ml-4",children:[f.jsx("p",{className:"text-purple-100",children:"My Customers"}),f.jsx("p",{className:"text-2xl font-bold",children:(null==(d=null==o?void 0:o.stats)?void 0:d.total_customers)||0})]})]})})})]}),"manager"===(null==o?void 0:o.role)&&(null==(c=null==o?void 0:o.stats)?void 0:c.pending_approvals)>0&&f.jsx("div",{className:"mb-8",children:f.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx(I,{className:"h-8 w-8 text-yellow-600"})}),f.jsxs("div",{className:"ml-4",children:[f.jsx("h3",{className:"text-lg font-medium text-yellow-800",children:"Pending Approvals"}),f.jsxs("p",{className:"text-yellow-700",children:["You have ",o.stats.pending_approvals," deal(s) waiting for approval."]}),f.jsx(l,{to:"/deals?status=waiting_approval",className:"inline-flex items-center mt-2 text-sm font-medium text-yellow-800 hover:text-yellow-900",children:"Review pending approvals →"})]})]})})}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[f.jsx("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:f.jsxs("div",{className:"p-6",children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Quick Actions"}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs(l,{to:"/leads",className:"flex items-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-colors group",children:[f.jsx(re,{className:"h-8 w-8 text-gray-400 group-hover:text-blue-500"}),f.jsxs("div",{className:"ml-4",children:[f.jsx("p",{className:"font-medium text-gray-900",children:"Add New Lead"}),f.jsx("p",{className:"text-sm text-gray-500",children:"Create new business opportunity"})]})]}),f.jsxs(l,{to:"/deals",className:"flex items-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-400 hover:bg-green-50 transition-colors group",children:[f.jsx(I,{className:"h-8 w-8 text-gray-400 group-hover:text-green-500"}),f.jsxs("div",{className:"ml-4",children:[f.jsx("p",{className:"font-medium text-gray-900",children:"Create Deal"}),f.jsx("p",{className:"text-sm text-gray-500",children:"Start new sales process"})]})]}),f.jsxs(l,{to:"/products",className:"flex items-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-400 hover:bg-purple-50 transition-colors group",children:[f.jsx(le,{className:"h-8 w-8 text-gray-400 group-hover:text-purple-500"}),f.jsxs("div",{className:"ml-4",children:[f.jsx("p",{className:"font-medium text-gray-900",children:"Manage Products"}),f.jsx("p",{className:"text-sm text-gray-500",children:"ISP packages and services"})]})]})]})]})}),f.jsx("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:f.jsxs("div",{className:"p-6",children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Recent Activity"}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex items-start space-x-3",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx("div",{className:"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center",children:f.jsx(q,{className:"h-4 w-4 text-green-600"})})}),f.jsxs("div",{className:"min-w-0 flex-1",children:[f.jsx("p",{className:"text-sm font-medium text-gray-900",children:"New customer registered"}),f.jsx("p",{className:"text-sm text-gray-500",children:"PT Global Tech Solutions - Internet 100Mbps"}),f.jsx("p",{className:"text-xs text-gray-400",children:"2 hours ago"})]})]}),f.jsxs("div",{className:"flex items-start space-x-3",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx("div",{className:"h-8 w-8 rounded-full bg-yellow-100 flex items-center justify-center",children:f.jsx(I,{className:"h-4 w-4 text-yellow-600"})})}),f.jsxs("div",{className:"min-w-0 flex-1",children:[f.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Deal needs approval"}),f.jsx("p",{className:"text-sm text-gray-500",children:"CV Berkah Digital - Rp 8,5M deal"}),f.jsx("p",{className:"text-xs text-gray-400",children:"4 hours ago"})]})]}),f.jsxs("div",{className:"flex items-start space-x-3",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx("div",{className:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center",children:f.jsx(re,{className:"h-4 w-4 text-blue-600"})})}),f.jsxs("div",{className:"min-w-0 flex-1",children:[f.jsx("p",{className:"text-sm font-medium text-gray-900",children:"New lead created"}),f.jsx("p",{className:"text-sm text-gray-500",children:"Sekolah Harapan Bangsa - WiFi infrastructure"}),f.jsx("p",{className:"text-xs text-gray-400",children:"6 hours ago"})]})]})]})]})})]})]}):f.jsx("div",{className:"py-12 text-center text-gray-500",children:f.jsx("p",{children:"No dashboard data available"})})]});var v},ve={async getAllProducts(){var e,s;try{return{success:!0,data:(await w.get("/products")).data}}catch(t){return{success:!1,error:(null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||"Failed to fetch products"}}},async getProductById(e){var s,t;try{return{success:!0,data:(await w.get(`/products/${e}`)).data}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to fetch product"}}},async createProduct(e){var s,t;try{return{success:!0,data:(await w.post("/products",e)).data}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to create product"}}},async updateProduct(e,s){var t,a;try{return{success:!0,data:(await w.put(`/products/${e}`,s)).data}}catch(r){return{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"Failed to update product"}}},async deleteProduct(e){var s,t;try{return{success:!0,data:(await w.delete(`/products/${e}`)).data}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to delete product"}}}},je=()=>{var s;const{user:t}=C(),[a,r]=e.useState([]),[l,n]=e.useState(!0),[i,d]=e.useState(""),[c,o]=e.useState(!1),[m,x]=e.useState(null),[u,h]=e.useState("all"),[g,p]=e.useState({name:"",description:"",hpp:"",margin_percentage:"",category:"residential",bandwidth:"",is_active:!0});e.useEffect(()=>{y()},[]);const y=async()=>{n(!0);try{const e=await ve.getAllProducts();if(e.success){const s=e.data.data||e.data;r(s),d("")}else d(e.error)}catch(e){d("Failed to load products. Please try again.")}finally{n(!1)}},v=()=>{x(null),p({name:"",description:"",hpp:"",margin_percentage:"",category:"residential",bandwidth:"",is_active:!0}),o(!0)},j=async e=>{e.preventDefault(),n(!0);try{let e;const s={...g,hpp:parseFloat(g.hpp),margin_percentage:parseFloat(g.margin_percentage)};e=m?await ve.updateProduct(m.id,s):await ve.createProduct(s),e.success?(await y(),o(!1),d("")):d(e.error)}catch(s){d("Failed to save product. Please try again.")}finally{n(!1)}},b=e=>e?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e):"Rp 0",N=e=>{switch(e){case"residential":return f.jsx(le,{className:"h-5 w-5 text-blue-600"});case"corporate":return f.jsx(X,{className:"h-5 w-5 text-purple-600"});case"gaming":return f.jsx(Y,{className:"h-5 w-5 text-red-600"});case"hotspot":return f.jsx(V,{className:"h-5 w-5 text-green-600"});default:return f.jsx(Y,{className:"h-5 w-5 text-gray-600"})}},w="all"===u?a:a.filter(e=>e.category===u),k={all:a.length,residential:a.filter(e=>"residential"===e.category).length,corporate:a.filter(e=>"corporate"===e.category).length,gaming:a.filter(e=>"gaming"===e.category).length,hotspot:a.filter(e=>"hotspot"===e.category).length};if(!t)return f.jsx("div",{className:"max-w-7xl mx-auto py-8",children:f.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:[f.jsx("h3",{className:"text-lg font-medium text-yellow-800",children:"Authentication Required"}),f.jsx("p",{className:"text-yellow-600 mt-2",children:"Please make sure you are logged in to view products."})]})});if(i&&!l)return f.jsxs("div",{className:"max-w-7xl mx-auto py-8",children:[f.jsxs("div",{className:"mb-8",children:[f.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[f.jsx(le,{className:"h-8 w-8 mr-3 text-indigo-600"}),"ISP Product Catalog"]}),f.jsx("p",{className:"mt-2 text-gray-600",children:"Manage internet services, packages, and pricing"})]}),f.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[f.jsx("h3",{className:"text-lg font-medium text-red-800",children:"Error Loading Products"}),f.jsx("p",{className:"text-red-600 mt-2",children:i}),f.jsx("button",{onClick:y,className:"mt-3 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Retry Loading Products"})]})]});try{return f.jsxs("div",{className:"max-w-7xl mx-auto py-8",children:[f.jsxs("div",{className:"mb-8",children:[f.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[f.jsx(le,{className:"h-8 w-8 mr-3 text-indigo-600"}),"ISP Product Catalog"]}),f.jsx("p",{className:"mt-2 text-gray-600",children:"Manage internet services, packages, and pricing"})]}),i&&f.jsx("div",{className:"mb-6",children:f.jsx(oe,{message:i,onClose:()=>d("")})}),f.jsx("div",{className:"mb-6",children:f.jsx("div",{className:"border-b border-gray-200",children:f.jsx("nav",{className:"-mb-px flex space-x-8",children:[{key:"all",label:"All Products",count:k.all},{key:"residential",label:"Residential",count:k.residential},{key:"corporate",label:"Corporate",count:k.corporate},{key:"gaming",label:"Gaming",count:k.gaming},{key:"hotspot",label:"Hotspot",count:k.hotspot}].map(e=>f.jsxs("button",{onClick:()=>h(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm "+(u===e.key?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.label,e.count>0&&f.jsx("span",{className:"ml-2 py-0.5 px-2 rounded-full text-xs "+(u===e.key?"bg-indigo-100 text-indigo-600":"bg-gray-100 text-gray-900"),children:e.count})]},e.key))})})}),l?f.jsx("div",{className:"text-center py-12",children:f.jsx(ce,{size:"lg",text:"Loading ISP services..."})}):f.jsxs("div",{className:"bg-white shadow-lg rounded-lg overflow-hidden",children:[f.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("div",{children:[f.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:["ISP Services & Packages (",w.length,")"]}),f.jsx("p",{className:"text-sm text-gray-600",children:"manager"===(null==t?void 0:t.role)?"Manage all products and pricing":"View available products"})]}),(null==(s=null==t?void 0:t.permissions)?void 0:s.can_manage_products)&&f.jsxs("button",{onClick:v,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 flex items-center",children:[f.jsx(Z,{className:"h-4 w-4 mr-2"}),"Add New Service"]})]})}),0===w.length?f.jsxs("div",{className:"p-12 text-center text-gray-500",children:[f.jsx(le,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),f.jsx("p",{className:"text-lg",children:"No ISP services found"}),f.jsx("p",{className:"text-sm",children:"all"===u?"Start by adding your first internet service package":`No ${u} products available`})]}):f.jsx("div",{className:"overflow-x-auto",children:f.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[f.jsx("thead",{className:"bg-gray-50",children:f.jsxs("tr",{children:[f.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Service / Package"}),f.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pricing Structure"}),f.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Bandwidth / Type"}),f.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),f.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),f.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(e=>f.jsxs("tr",{className:"hover:bg-gray-50 transition duration-200",children:[f.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:f.jsx("div",{className:"h-10 w-10 bg-indigo-100 rounded-lg flex items-center justify-center",children:N(e.category)})}),f.jsxs("div",{className:"ml-4",children:[f.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),f.jsxs("div",{className:"text-sm text-gray-500 capitalize",children:[e.category," Service"]})]})]})}),f.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:f.jsxs("div",{className:"text-sm text-gray-900",children:[f.jsxs("div",{className:"font-medium text-green-600",children:["Selling: ",b(e.selling_price)]}),f.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[f.jsxs("div",{children:["HPP: ",b(e.hpp)]}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("span",{children:["Margin: ",e.margin_percentage,"%"]}),f.jsxs("span",{className:"font-medium text-blue-600",children:["+",b(e.selling_price-e.hpp)]})]})]})]})}),f.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:f.jsxs("div",{className:"text-sm text-gray-900",children:[f.jsx("div",{className:"font-medium",children:e.bandwidth}),f.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+("corporate"===e.category?"bg-purple-100 text-purple-800":"gaming"===e.category?"bg-red-100 text-red-800":"hotspot"===e.category?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:e.category.toUpperCase()})]})}),f.jsx("td",{className:"px-6 py-4",children:f.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:e.description||"No description"})}),f.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:f.jsx("div",{className:"flex items-center justify-end space-x-2",children:"manager"===(null==t?void 0:t.role)&&f.jsxs(f.Fragment,{children:[f.jsx("button",{onClick:()=>(e=>{x(e),p({name:e.name||"",description:e.description||"",hpp:e.hpp||"",margin_percentage:e.margin_percentage||"",category:e.category||"residential",bandwidth:e.bandwidth||"",is_active:!1!==e.is_active}),o(!0)})(e),className:"text-indigo-600 hover:text-indigo-900 p-2 hover:bg-indigo-50 rounded-md transition duration-200",children:f.jsx(G,{className:"h-4 w-4"})}),f.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this product?"))try{const s=await ve.deleteProduct(e);s.success?(await y(),d("")):d(s.error)}catch(s){d("Failed to delete product. Please try again.")}})(e.id),className:"text-red-600 hover:text-red-900 p-2 hover:bg-red-50 rounded-md transition duration-200",children:f.jsx(ee,{className:"h-4 w-4"})})]})})})]},e.id))})]})})]}),c&&f.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:f.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:f.jsxs("div",{className:"mt-3",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900",children:m?"Edit Product":"Add New Product"}),f.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-gray-600",children:f.jsx(ie,{className:"h-6 w-6"})})]}),f.jsxs("form",{onSubmit:j,className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Name"}),f.jsx("input",{type:"text",value:g.name,onChange:e=>p({...g,name:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),f.jsx("textarea",{value:g.description,onChange:e=>p({...g,description:e.target.value}),rows:3,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Category"}),f.jsxs("select",{value:g.category,onChange:e=>p({...g,category:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",children:[f.jsx("option",{value:"residential",children:"Residential"}),f.jsx("option",{value:"corporate",children:"Corporate"}),f.jsx("option",{value:"gaming",children:"Gaming"}),f.jsx("option",{value:"hotspot",children:"Hotspot"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Bandwidth"}),f.jsx("input",{type:"text",value:g.bandwidth,onChange:e=>p({...g,bandwidth:e.target.value}),placeholder:"e.g., 100Mbps",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"HPP (Cost Price)"}),f.jsx("input",{type:"number",value:g.hpp,onChange:e=>p({...g,hpp:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Margin Percentage"}),f.jsx("input",{type:"number",value:g.margin_percentage,onChange:e=>p({...g,margin_percentage:e.target.value}),min:"0",max:"100",step:"0.01",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),f.jsxs("div",{className:"flex items-center",children:[f.jsx("input",{type:"checkbox",id:"is_active",checked:g.is_active,onChange:e=>p({...g,is_active:e.target.checked}),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),f.jsx("label",{htmlFor:"is_active",className:"ml-2 block text-sm text-gray-900",children:"Active Product"})]}),f.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[f.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"}),f.jsx("button",{type:"submit",disabled:l,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 flex items-center",children:l?f.jsxs(f.Fragment,{children:[f.jsx(ce,{size:"sm"}),f.jsx("span",{className:"ml-2",children:"Saving..."})]}):f.jsxs(f.Fragment,{children:[f.jsx(J,{className:"h-4 w-4 mr-2"}),m?"Update":"Create"," Product"]})})]})]})]})})})]})}catch(_){return f.jsx("div",{className:"max-w-7xl mx-auto py-8",children:f.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[f.jsx("h3",{className:"text-lg font-medium text-red-800",children:"Error Loading Products Page"}),f.jsx("p",{className:"text-red-600 mt-2",children:"There was an error loading the products page. Please check the console for details."}),f.jsxs("p",{className:"text-sm text-red-500 mt-1",children:["Error: ",_.message]})]})})}},fe=async()=>{var e,s;try{return{success:!0,data:(await w.get("/leads")).data}}catch(t){return{success:!1,error:(null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||"Failed to fetch leads"}}},be=async e=>{var s,t;try{return{success:!0,data:(await w.post("/leads",e)).data}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to create lead"}}},Ne=async(e,s)=>{var t,a;try{return{success:!0,data:(await w.put(`/leads/${e}`,s)).data}}catch(r){return{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"Failed to update lead"}}},we=async e=>{var s,t;try{return await w.delete(`/leads/${e}`),{success:!0}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to delete lead"}}},ke=async(e,s)=>{var t,a;try{return{success:!0,data:(await w.patch(`/leads/${e}/status`,{status:s})).data}}catch(r){return{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"Failed to update lead status"}}},_e=()=>{const{user:s}=C(),[t,a]=e.useState([]),[r,l]=e.useState(!0),[n,i]=e.useState(""),[d,c]=e.useState("all"),[o,m]=e.useState(!1),[x,u]=e.useState(null),[h,g]=e.useState({name:"",email:"",phone:"",address:"",needs:"",source:"",notes:"",status:"new"});e.useEffect(()=>{p()},[]);const p=async()=>{l(!0);try{const e=await fe();e.success?(a(e.data.data||e.data),i("")):i(e.error)}catch(e){i("Failed to load leads. Please try again.")}finally{l(!1)}},y=e=>{switch(e){case"new":return"bg-blue-100 text-blue-800";case"contacted":return"bg-yellow-100 text-yellow-800";case"qualified":return"bg-green-100 text-green-800";case"proposal":return"bg-purple-100 text-purple-800";case"negotiation":return"bg-orange-100 text-orange-800";case"closed_won":return"bg-green-200 text-green-900";case"closed_lost":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},v="all"===d?t:t.filter(e=>e.status===d),j={all:t.length,new:t.filter(e=>"new"===e.status).length,contacted:t.filter(e=>"contacted"===e.status).length,qualified:t.filter(e=>"qualified"===e.status).length,closed_won:t.filter(e=>"closed_won"===e.status).length,closed_lost:t.filter(e=>"closed_lost"===e.status).length};return f.jsxs("div",{className:"max-w-7xl mx-auto py-8",children:[f.jsxs("div",{className:"mb-8",children:[f.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[f.jsx(re,{className:"h-8 w-8 mr-3 text-indigo-600"}),"Lead Management"]}),f.jsx("p",{className:"mt-2 text-gray-600",children:"Manage ISP service prospects and potential customers"})]}),n&&f.jsx("div",{className:"mb-6",children:f.jsx(oe,{message:n,onClose:()=>i("")})}),f.jsx("div",{className:"mb-6",children:f.jsx("div",{className:"border-b border-gray-200",children:f.jsx("nav",{className:"-mb-px flex space-x-8",children:[{key:"all",label:"All Leads",count:j.all},{key:"new",label:"New",count:j.new},{key:"contacted",label:"Contacted",count:j.contacted},{key:"qualified",label:"Qualified",count:j.qualified},{key:"closed_won",label:"Won",count:j.closed_won},{key:"closed_lost",label:"Lost",count:j.closed_lost}].map(e=>f.jsxs("button",{onClick:()=>c(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm "+(d===e.key?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.label,e.count>0&&f.jsx("span",{className:"ml-2 py-0.5 px-2 rounded-full text-xs "+(d===e.key?"bg-indigo-100 text-indigo-600":"bg-gray-100 text-gray-900"),children:e.count})]},e.key))})})}),r?f.jsx("div",{className:"text-center py-12",children:f.jsx(ce,{size:"lg",text:"Loading leads..."})}):f.jsxs("div",{className:"bg-white shadow-lg rounded-lg overflow-hidden",children:[f.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("div",{children:[f.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:["Leads (",v.length,")"]}),f.jsx("p",{className:"text-sm text-gray-600",children:"manager"===(null==s?void 0:s.role)?"All team leads":"Your assigned leads"})]}),f.jsxs("button",{onClick:()=>{u(null),g({name:"",email:"",phone:"",address:"",needs:"",source:"",notes:"",status:"new"}),m(!0)},className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 flex items-center",children:[f.jsx(Z,{className:"h-4 w-4 mr-2"}),"Add New Lead"]})]})}),0===v.length?f.jsxs("div",{className:"p-12 text-center text-gray-500",children:[f.jsx(re,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),f.jsx("p",{className:"text-lg",children:"No leads found"}),f.jsx("p",{className:"text-sm",children:"all"===d?"Start by adding your first potential customer":`No leads with status: ${d.replace("_"," ")}`})]}):f.jsx("div",{className:"divide-y divide-gray-200",children:v.map(e=>{var s,t;return f.jsx("div",{className:"p-6 hover:bg-gray-50 transition duration-200",children:f.jsxs("div",{className:"flex items-start justify-between",children:[f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900",children:e.name}),f.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${y(e.status)}`,children:e.status.charAt(0).toUpperCase()+e.status.slice(1).replace("_"," ")})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm text-gray-600 mb-4",children:[e.email&&f.jsxs("div",{className:"flex items-center",children:[f.jsx(B,{className:"h-4 w-4 mr-2"}),e.email]}),e.phone&&f.jsxs("div",{className:"flex items-center",children:[f.jsx(Q,{className:"h-4 w-4 mr-2"}),e.phone]}),e.address&&f.jsxs("div",{className:"flex items-center",children:[f.jsx(W,{className:"h-4 w-4 mr-2"}),e.address]})]}),e.needs&&f.jsx("div",{className:"mb-3",children:f.jsxs("p",{className:"text-sm text-gray-700",children:[f.jsx("span",{className:"font-medium",children:"Requirements:"})," ",e.needs]})}),e.notes&&f.jsx("div",{className:"mb-3",children:f.jsxs("p",{className:"text-sm text-gray-700",children:[f.jsx("span",{className:"font-medium",children:"Notes:"})," ",e.notes]})}),f.jsx("div",{className:"flex items-center justify-between text-xs text-gray-500",children:f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsxs("div",{className:"flex items-center",children:[f.jsx(re,{className:"h-3 w-3 mr-1"}),"Sales: ",(null==(s=e.sales)?void 0:s.name)||"Unassigned"]}),f.jsxs("div",{className:"flex items-center",children:[f.jsx(L,{className:"h-3 w-3 mr-1"}),"Created: ",(t=e.created_at,new Date(t).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}))]})]})})]}),f.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[f.jsxs("select",{value:e.status,onChange:s=>(async(e,s)=>{try{const t=await ke(e,s);t.success?(await p(),i("")):i(t.error)}catch(t){i("Failed to update lead status. Please try again.")}})(e.id,s.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[f.jsx("option",{value:"new",children:"New"}),f.jsx("option",{value:"contacted",children:"Contacted"}),f.jsx("option",{value:"qualified",children:"Qualified"}),f.jsx("option",{value:"proposal",children:"Proposal"}),f.jsx("option",{value:"negotiation",children:"Negotiation"}),f.jsx("option",{value:"closed_won",children:"Won"}),f.jsx("option",{value:"closed_lost",children:"Lost"})]}),f.jsx("button",{onClick:()=>(e=>{u(e),g({name:e.name||"",email:e.email||"",phone:e.phone||"",address:e.address||"",needs:e.needs||"",source:e.source||"",notes:e.notes||"",status:e.status||"new"}),m(!0)})(e),className:"text-indigo-600 hover:text-indigo-900 p-2 hover:bg-indigo-50 rounded-md transition duration-200",children:f.jsx(G,{className:"h-4 w-4"})}),f.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this lead?"))try{const s=await we(e);s.success?(await p(),i("")):i(s.error)}catch(s){i("Failed to delete lead. Please try again.")}})(e.id),className:"text-red-600 hover:text-red-900 p-2 hover:bg-red-50 rounded-md transition duration-200",children:f.jsx(ee,{className:"h-4 w-4"})})]})]})},e.id)})})]}),o&&f.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:f.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:f.jsxs("div",{className:"mt-3",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900",children:x?"Edit Lead":"Create New Lead"}),f.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:f.jsx(ie,{className:"h-6 w-6"})})]}),f.jsxs("form",{onSubmit:async e=>{e.preventDefault(),l(!0);try{let e;e=x?await Ne(x.id,h):await be(h),e.success?(await p(),m(!1),i("")):i(e.error)}catch(s){i("Failed to save lead. Please try again.")}finally{l(!1)}},className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),f.jsx("input",{type:"text",required:!0,value:h.name,onChange:e=>g({...h,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),f.jsx("input",{type:"email",value:h.email,onChange:e=>g({...h,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),f.jsx("input",{type:"text",value:h.phone,onChange:e=>g({...h,phone:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),f.jsx("textarea",{value:h.address,onChange:e=>g({...h,address:e.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Needs/Requirements"}),f.jsx("textarea",{value:h.needs,onChange:e=>g({...h,needs:e.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Source"}),f.jsxs("select",{value:h.source,onChange:e=>g({...h,source:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[f.jsx("option",{value:"",children:"Select source..."}),f.jsx("option",{value:"website",children:"Website"}),f.jsx("option",{value:"referral",children:"Referral"}),f.jsx("option",{value:"cold_call",children:"Cold Call"}),f.jsx("option",{value:"social_media",children:"Social Media"}),f.jsx("option",{value:"event",children:"Event"}),f.jsx("option",{value:"other",children:"Other"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),f.jsxs("select",{value:h.status,onChange:e=>g({...h,status:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[f.jsx("option",{value:"new",children:"New"}),f.jsx("option",{value:"contacted",children:"Contacted"}),f.jsx("option",{value:"qualified",children:"Qualified"}),f.jsx("option",{value:"proposal",children:"Proposal"}),f.jsx("option",{value:"negotiation",children:"Negotiation"}),f.jsx("option",{value:"closed_won",children:"Won"}),f.jsx("option",{value:"closed_lost",children:"Lost"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),f.jsx("textarea",{value:h.notes,onChange:e=>g({...h,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),f.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[f.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),f.jsxs("button",{type:"submit",disabled:r,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 flex items-center",children:[f.jsx(J,{className:"h-4 w-4 mr-2"}),r?"Saving...":x?"Update":"Create"]})]})]})]})})})]})},Ce=async()=>{var e,s;try{return{success:!0,data:(await w.get("/customers")).data}}catch(t){return{success:!1,error:(null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||"Failed to fetch customers"}}},Se=async e=>{var s,t;try{return{success:!0,data:(await w.post("/customers",e)).data}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to create customer"}}},De=async(e,s)=>{var t,a;try{return{success:!0,data:(await w.put(`/customers/${e}`,s)).data}}catch(r){return{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"Failed to update customer"}}},Me=async e=>{var s,t;try{return await w.delete(`/customers/${e}`),{success:!0}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to delete customer"}}},Pe=async e=>{var s,t;try{return{success:!0,data:(await w.get(`/customers/${e}/services`)).data}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to fetch customer services"}}},Fe=()=>{const{user:s}=C(),[t,a]=e.useState([]),[r,l]=e.useState(!0),[n,i]=e.useState(""),[d,c]=e.useState("all"),[o,m]=e.useState(!1),[x,u]=e.useState(!1),[h,g]=e.useState(null),[p,y]=e.useState(null),[v,j]=e.useState([]),[b,N]=e.useState({name:"",email:"",phone:"",customer_type:"individual",billing_address:"",installation_address:"",contact_person:"",company_name:"",tax_number:"",notes:""});e.useEffect(()=>{w()},[]);const w=async()=>{l(!0);try{const e=await Ce();e.success?(a(e.data.data||e.data),i("")):i(e.error)}catch(e){i("Failed to load customers. Please try again.")}finally{l(!1)}},k=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),_=e=>new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),S=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"suspended":return"bg-yellow-100 text-yellow-800";case"terminated":return"bg-red-100 text-red-800";case"pending":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},D=e=>{switch(e){case"individual":return"bg-blue-100 text-blue-800";case"corporate":return"bg-purple-100 text-purple-800";case"government":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},M="all"===d?t:t.filter(e=>e.status===d),P={all:t.length,active:t.filter(e=>"active"===e.status).length,suspended:t.filter(e=>"suspended"===e.status).length,terminated:t.filter(e=>"terminated"===e.status).length};return f.jsxs("div",{className:"max-w-7xl mx-auto py-8",children:[f.jsxs("div",{className:"mb-8",children:[f.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[f.jsx(q,{className:"h-8 w-8 mr-3 text-indigo-600"}),"Active Customers"]}),f.jsx("p",{className:"mt-2 text-gray-600",children:"Manage your active ISP customers and their services"})]}),n&&f.jsx("div",{className:"mb-6",children:f.jsx(oe,{message:n,onClose:()=>i("")})}),f.jsx("div",{className:"mb-6",children:f.jsx("div",{className:"border-b border-gray-200",children:f.jsx("nav",{className:"-mb-px flex space-x-8",children:[{key:"all",label:"All Customers",count:P.all},{key:"active",label:"Active",count:P.active},{key:"suspended",label:"Suspended",count:P.suspended},{key:"terminated",label:"Terminated",count:P.terminated}].map(e=>f.jsxs("button",{onClick:()=>c(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm "+(d===e.key?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.label,e.count>0&&f.jsx("span",{className:"ml-2 py-0.5 px-2 rounded-full text-xs "+(d===e.key?"bg-indigo-100 text-indigo-600":"bg-gray-100 text-gray-900"),children:e.count})]},e.key))})})}),r?f.jsx("div",{className:"text-center py-12",children:f.jsx(ce,{size:"lg",text:"Loading customers..."})}):f.jsxs("div",{className:"bg-white shadow-lg rounded-lg overflow-hidden",children:[f.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:f.jsx("div",{className:"flex justify-between items-center",children:f.jsxs("div",{children:[f.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:["Customer Database (",M.length," customers)"]}),f.jsx("p",{className:"text-sm text-gray-600",children:"manager"===(null==s?void 0:s.role)?"All customers":"Your assigned customers"})]})})}),0===M.length?f.jsxs("div",{className:"p-12 text-center text-gray-500",children:[f.jsx(q,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),f.jsx("p",{className:"text-lg",children:"No customers found"}),f.jsx("p",{className:"text-sm",children:"all"===d?"Start by converting leads to customers":`No ${d} customers found`})]}):f.jsx("div",{className:"divide-y divide-gray-200",children:M.map(e=>{var t,a;return f.jsxs("div",{className:"p-6 hover:bg-gray-50 transition duration-200",children:[f.jsxs("div",{className:"flex items-start justify-between mb-4",children:[f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[f.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:e.name}),f.jsx("span",{className:`inline-flex px-3 py-1 text-sm font-semibold rounded-full ${S(e.status||"active")}`,children:(e.status||"active").charAt(0).toUpperCase()+(e.status||"active").slice(1)}),e.customer_type&&f.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${D(e.customer_type)}`,children:e.customer_type.charAt(0).toUpperCase()+e.customer_type.slice(1)})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm text-gray-600 mb-4",children:[e.email&&f.jsxs("div",{className:"flex items-center",children:[f.jsx(Q,{className:"h-4 w-4 mr-2"}),e.email]}),e.phone&&f.jsxs("div",{className:"flex items-center",children:[f.jsx(Q,{className:"h-4 w-4 mr-2"}),e.phone]}),e.billing_address&&f.jsxs("div",{className:"flex items-center",children:[f.jsx(W,{className:"h-4 w-4 mr-2"}),e.billing_address]}),f.jsxs("div",{className:"flex items-center",children:[f.jsx(L,{className:"h-4 w-4 mr-2"}),"Customer since: ",_(e.created_at)]}),f.jsxs("div",{className:"flex items-center",children:[f.jsx(re,{className:"h-4 w-4 mr-2"}),"Sales: ",(null==(t=e.sales)?void 0:t.name)||"Unassigned"]}),e.customer_number&&f.jsxs("div",{className:"flex items-center font-medium text-indigo-600",children:["ID: ",e.customer_number]})]})]}),f.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[f.jsx("button",{onClick:()=>(async e=>{y(e);try{const s=await Pe(e.id);s.success?(j(s.data),m(!0)):i(s.error)}catch(s){i("Failed to load customer services.")}})(e),className:"text-blue-600 hover:text-blue-900 p-2 hover:bg-blue-50 rounded-md transition duration-200",title:"View Services",children:f.jsx(H,{className:"h-4 w-4"})}),f.jsx("button",{onClick:()=>(e=>{g(e),N({name:e.name||"",email:e.email||"",phone:e.phone||"",customer_type:e.customer_type||"individual",billing_address:e.billing_address||"",installation_address:e.installation_address||"",contact_person:e.contact_person||"",company_name:e.company_name||"",tax_number:e.tax_number||"",notes:e.notes||""}),u(!0)})(e),className:"text-indigo-600 hover:text-indigo-900 p-2 hover:bg-indigo-50 rounded-md transition duration-200",children:f.jsx(G,{className:"h-4 w-4"})}),"manager"===(null==s?void 0:s.role)&&f.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this customer?"))try{const s=await Me(e);s.success?(await w(),i("")):i(s.error)}catch(s){i("Failed to delete customer. Please try again.")}})(e.id),className:"text-red-600 hover:text-red-900 p-2 hover:bg-red-50 rounded-md transition duration-200",children:f.jsx(ee,{className:"h-4 w-4"})})]})]}),f.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[f.jsxs("h4",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center",children:[f.jsx(le,{className:"h-4 w-4 mr-2"}),"Services Overview (",(null==(a=e.services)?void 0:a.length)||0,")"]}),e.services&&e.services.length>0?f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.services.slice(0,2).map(e=>f.jsxs("div",{className:"flex items-center justify-between bg-white p-2 rounded text-sm",children:[f.jsx("span",{className:"font-medium",children:e.product_name||e.name}),f.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${S(e.status)}`,children:e.status})]},e.id)),e.services.length>2&&f.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["+",e.services.length-2," more services"]})]}):f.jsx("p",{className:"text-sm text-gray-500",children:"No active services"})]})]},e.id)})})]}),o&&p&&f.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:f.jsx("div",{className:"relative top-10 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white",children:f.jsxs("div",{className:"mt-3",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Services for ",p.name]}),f.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:f.jsx(ie,{className:"h-6 w-6"})})]}),f.jsx("div",{className:"space-y-4",children:0===v.length?f.jsxs("div",{className:"text-center py-8 text-gray-500",children:[f.jsx(le,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),f.jsx("p",{children:"No services found for this customer"})]}):v.map(e=>f.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:f.jsxs("div",{className:"flex items-start justify-between",children:[f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[f.jsx("h4",{className:"font-medium text-gray-900",children:e.product_name||e.name}),f.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${S(e.status)}`,children:e.status})]}),f.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[f.jsxs("div",{children:[f.jsx("span",{className:"font-medium",children:"Service ID:"}),f.jsx("br",{}),e.service_number||e.id]}),f.jsxs("div",{children:[f.jsx("span",{className:"font-medium",children:"Monthly Fee:"}),f.jsx("br",{}),k(e.monthly_fee||e.price||0)]}),f.jsxs("div",{children:[f.jsx("span",{className:"font-medium",children:"Installation Fee:"}),f.jsx("br",{}),k(e.installation_fee||0)]}),f.jsxs("div",{children:[f.jsx("span",{className:"font-medium",children:"Billing Cycle:"}),f.jsx("br",{}),e.billing_cycle||"Monthly"]}),f.jsxs("div",{children:[f.jsx("span",{className:"font-medium",children:"Start Date:"}),f.jsx("br",{}),e.start_date?_(e.start_date):_(e.created_at)]}),f.jsxs("div",{children:[f.jsx("span",{className:"font-medium",children:"Equipment:"}),f.jsx("br",{}),e.equipment_info||"Not specified"]})]})]}),f.jsx("div",{className:"flex items-center space-x-2 ml-4",children:f.jsx("button",{className:"text-indigo-600 hover:text-indigo-900 p-2 hover:bg-indigo-50 rounded-md",children:f.jsx(K,{className:"h-4 w-4"})})})]})},e.id))}),f.jsx("div",{className:"flex justify-end mt-6",children:f.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"Close"})})]})})}),x&&f.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:f.jsx("div",{className:"relative top-10 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white",children:f.jsxs("div",{className:"mt-3",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900",children:h?"Edit Customer":"Add New Customer"}),f.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600",children:f.jsx(ie,{className:"h-6 w-6"})})]}),f.jsxs("form",{onSubmit:async e=>{e.preventDefault(),l(!0);try{let e;e=h?await De(h.id,b):await Se(b),e.success?(await w(),u(!1),i("")):i(e.error)}catch(s){i("Failed to save customer. Please try again.")}finally{l(!1)}},className:"space-y-4",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Customer Name *"}),f.jsx("input",{type:"text",value:b.name,onChange:e=>N({...b,name:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Customer Type *"}),f.jsxs("select",{value:b.customer_type,onChange:e=>N({...b,customer_type:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",children:[f.jsx("option",{value:"individual",children:"Individual"}),f.jsx("option",{value:"corporate",children:"Corporate"}),f.jsx("option",{value:"government",children:"Government"})]})]})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email *"}),f.jsx("input",{type:"email",value:b.email,onChange:e=>N({...b,email:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone *"}),f.jsx("input",{type:"tel",value:b.phone,onChange:e=>N({...b,phone:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]})]}),"corporate"===b.customer_type&&f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Company Name"}),f.jsx("input",{type:"text",value:b.company_name,onChange:e=>N({...b,company_name:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tax Number (NPWP)"}),f.jsx("input",{type:"text",value:b.tax_number,onChange:e=>N({...b,tax_number:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Contact Person"}),f.jsx("input",{type:"text",value:b.contact_person,onChange:e=>N({...b,contact_person:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Contact person name"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Billing Address *"}),f.jsx("textarea",{value:b.billing_address,onChange:e=>N({...b,billing_address:e.target.value}),rows:2,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Complete billing address",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Installation Address"}),f.jsx("textarea",{value:b.installation_address,onChange:e=>N({...b,installation_address:e.target.value}),rows:2,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Service installation address (if different from billing)"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),f.jsx("textarea",{value:b.notes,onChange:e=>N({...b,notes:e.target.value}),rows:3,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Additional notes about the customer"})]}),f.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[f.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"}),f.jsx("button",{type:"submit",disabled:r,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 flex items-center",children:r?f.jsxs(f.Fragment,{children:[f.jsx(ce,{size:"sm"}),f.jsx("span",{className:"ml-2",children:"Saving..."})]}):f.jsxs(f.Fragment,{children:[f.jsx(J,{className:"h-4 w-4 mr-2"}),h?"Update Customer":"Create Customer"]})})]})]})]})})})]})},Re={async getDeals(e={}){var s,t;try{return{success:!0,data:(await w.get("/deals",{params:e})).data}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to fetch deals"}}},async getDeal(e){var s,t;try{return{success:!0,data:(await w.get(`/deals/${e}`)).data}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to fetch deal"}}},async createDeal(e){var s,t;try{return{success:!0,data:(await w.post("/deals",e)).data}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to create deal"}}},async updateDeal(e,s){var t,a;try{return{success:!0,data:(await w.put(`/deals/${e}`,s)).data}}catch(r){return{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"Failed to update deal"}}},async deleteDeal(e){var s,t;try{return await w.delete(`/deals/${e}`),{success:!0}}catch(a){return{success:!1,error:(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||"Failed to delete deal"}}},async approveDeal(e,s={}){var t,a;try{return{success:!0,data:(await w.post(`/deals/${e}/approve`,s)).data}}catch(r){return{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"Failed to approve deal"}}},async closeDeal(e,s){var t,a;try{return{success:!0,data:(await w.post(`/deals/${e}/close`,s)).data}}catch(r){return{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"Failed to close deal"}}},async getDealsStats(){var e,s;try{return{success:!0,data:(await w.get("/deals-stats")).data}}catch(t){return{success:!1,error:(null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||"Failed to fetch deals statistics"}}},async getDealsNeedingApproval(){var e,s;try{return{success:!0,data:(await w.get("/deals-approval")).data}}catch(t){return{success:!1,error:(null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||"Failed to fetch deals needing approval"}}},async addDealItem(e,s){var t,a;try{return{success:!0,data:(await w.post(`/deals/${e}/items`,s)).data}}catch(r){return{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"Failed to add deal item"}}},async updateDealItem(e,s,t){var a,r;try{return{success:!0,data:(await w.put(`/deals/${e}/items/${s}`,t)).data}}catch(l){return{success:!1,error:(null==(r=null==(a=l.response)?void 0:a.data)?void 0:r.message)||"Failed to update deal item"}}},async removeDealItem(e,s){var t,a;try{return await w.delete(`/deals/${e}/items/${s}`),{success:!0}}catch(r){return{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"Failed to remove deal item"}}}},ze=()=>{const{user:s}=C(),[t,a]=e.useState([]),[r,l]=e.useState(!0),[n,i]=e.useState(""),[d,c]=e.useState("all"),[o,m]=e.useState(!1),[x,u]=e.useState(null),[h,g]=e.useState([]),[p,y]=e.useState([]),[v,j]=e.useState({title:"",lead_id:"",notes:"",status:"waiting_approval"}),[b,N]=e.useState([{product_id:"",quantity:1,unit_price:0,negotiated_price:0,discount_percentage:0}]);e.useEffect(()=>{w(),_(),S()},[]);const w=async()=>{l(!0);try{const e=await Re.getDeals();e.success?(a(e.data.data||e.data),i("")):i(e.error)}catch(e){i("Failed to load deals. Please try again.")}finally{l(!1)}},k=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),_=async()=>{try{const e=await ve.getAllProducts();e.success&&g(e.data.data||e.data)}catch(e){}},S=async()=>{try{const e=await fe();if(e.success){const s=(e.data.data||e.data).filter(e=>"qualified"===e.status||"new"===e.status||"contacted"===e.status);y(s)}}catch(e){}},D=e=>{switch(e){case"waiting_approval":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"closed_won":return"bg-emerald-100 text-emerald-800";default:return"bg-gray-100 text-gray-800"}},M=e=>{switch(e){case"waiting_approval":default:return f.jsx(T,{className:"h-4 w-4"});case"approved":return f.jsx(E,{className:"h-4 w-4"});case"rejected":return f.jsx(ie,{className:"h-4 w-4"});case"closed_won":return f.jsx(te,{className:"h-4 w-4"});case"closed_lost":return f.jsx(ne,{className:"h-4 w-4"})}},P=(e,s,t)=>{const a=[...b];if(a[e]={...a[e],[s]:t},"product_id"===s){const s=h.find(e=>e.id===t);s&&(a[e].unit_price=parseFloat(s.selling_price),a[e].negotiated_price=parseFloat(s.selling_price),a[e].discount_percentage=0)}else if("unit_price"===s||"discount_percentage"===s){const s=parseFloat(a[e].unit_price)||0,t=parseFloat(a[e].discount_percentage)||0;a[e].negotiated_price=s*(1-t/100)}N(a)},F="all"===d?t:t.filter(e=>e.status===d),R={all:t.length,waiting_approval:t.filter(e=>"waiting_approval"===e.status).length,approved:t.filter(e=>"approved"===e.status).length,rejected:t.filter(e=>"rejected"===e.status).length,closed_won:t.filter(e=>"closed_won"===e.status).length,closed_lost:t.filter(e=>"closed_lost"===e.status).length};return f.jsxs("div",{className:"max-w-7xl mx-auto py-8",children:[f.jsxs("div",{className:"mb-8",children:[f.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[f.jsx(I,{className:"h-8 w-8 mr-3 text-indigo-600"}),"Deal Pipeline"]}),f.jsx("p",{className:"mt-2 text-gray-600",children:"Manage deal negotiations and approvals"})]}),n&&f.jsx(oe,{message:n,onClose:()=>i(""),className:"mb-6"}),f.jsx("div",{className:"mb-6",children:f.jsx("div",{className:"border-b border-gray-200",children:f.jsx("nav",{className:"-mb-px flex space-x-8",children:[{key:"all",label:"All Deals",count:R.all},{key:"waiting_approval",label:"Waiting Approval",count:R.waiting_approval},{key:"approved",label:"Approved",count:R.approved},{key:"rejected",label:"Rejected",count:R.rejected},{key:"closed_won",label:"Closed Won",count:R.closed_won},{key:"closed_lost",label:"Closed Lost",count:R.closed_lost}].map(e=>f.jsxs("button",{onClick:()=>c(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm "+(d===e.key?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.label,e.count>0&&f.jsx("span",{className:"ml-2 py-0.5 px-2 rounded-full text-xs "+(d===e.key?"bg-indigo-100 text-indigo-600":"bg-gray-100 text-gray-900"),children:e.count})]},e.key))})})}),r?f.jsx("div",{className:"text-center py-12",children:f.jsx(ce,{size:"lg",text:"Loading projects..."})}):f.jsxs("div",{className:"bg-white shadow-lg rounded-lg overflow-hidden",children:[f.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:["Deals (",F.length,")"]}),f.jsxs("button",{onClick:()=>{u(null),j({title:"",lead_id:"",notes:"",status:"waiting_approval"}),N([{product_id:"",quantity:1,unit_price:0,negotiated_price:0,discount_percentage:0}]),m(!0)},className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 flex items-center",children:[f.jsx(Z,{className:"h-4 w-4 mr-2"}),"New Deal"]})]})}),0===F.length?f.jsxs("div",{className:"p-12 text-center text-gray-500",children:[f.jsx(I,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),f.jsx("p",{className:"text-lg",children:"No deals found"}),f.jsx("p",{className:"text-sm",children:"all"===d?"Start by creating your first deal":`No deals with status: ${d.replace("_"," ")}`})]}):f.jsx("div",{className:"divide-y divide-gray-200",children:F.map(e=>{var t,a,r;return f.jsxs("div",{className:"p-6 hover:bg-gray-50 transition duration-200",children:[f.jsxs("div",{className:"flex items-start justify-between mb-4",children:[f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[f.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.title||e.deal_number}),f.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${D(e.status)}`,children:[M(e.status),f.jsx("span",{className:"ml-1 capitalize",children:e.status.replace("_"," ")})]}),e.needs_approval&&f.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800",children:"Needs Approval"})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600 mb-4",children:[f.jsxs("div",{className:"flex items-center",children:[f.jsx(ae,{className:"h-4 w-4 mr-2"}),"Sales: ",(null==(t=e.sales)?void 0:t.name)||"Unknown"]}),f.jsxs("div",{className:"flex items-center",children:[f.jsx(L,{className:"h-4 w-4 mr-2"}),"Created: ",(r=e.created_at,new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}))]}),f.jsxs("div",{className:"flex items-center font-medium text-green-600",children:[f.jsx($,{className:"h-4 w-4 mr-2"}),"Total: ",k(e.final_amount||e.total_amount)]})]}),e.rejection_reason&&f.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:f.jsxs("p",{className:"text-sm text-red-700",children:[f.jsx("strong",{children:"Rejection Reason:"})," ",e.rejection_reason]})})]}),f.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:["waiting_approval"===e.status&&"manager"===(null==s?void 0:s.role)&&f.jsxs(f.Fragment,{children:[f.jsx("button",{onClick:()=>(async e=>{try{const s=await Re.approveDeal(e,{approved:!0});s.success?(await w(),i("")):i(s.error)}catch(s){i("Failed to approve deal. Please try again.")}})(e.id),className:"text-green-600 hover:text-green-900 p-2 hover:bg-green-50 rounded-md transition duration-200",title:"Approve Deal",children:f.jsx(E,{className:"h-4 w-4"})}),f.jsx("button",{onClick:()=>(async e=>{const s=prompt("Please provide a reason for rejection:");if(s)try{const t=await Re.approveDeal(e,{approved:!1,notes:s});t.success?(await w(),i("")):i(t.error)}catch(t){i("Failed to reject deal. Please try again.")}})(e.id),className:"text-red-600 hover:text-red-900 p-2 hover:bg-red-50 rounded-md transition duration-200",title:"Reject Deal",children:f.jsx(ie,{className:"h-4 w-4"})})]}),"approved"===e.status&&f.jsxs(f.Fragment,{children:[f.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to close this deal as WON? This will automatically create a customer."))try{const s=await Re.closeDeal(e,{status:"closed_won",notes:"Deal closed as won - customer created automatically"});s.success?(await w(),i(""),alert("Deal closed successfully! Customer has been created automatically.")):i(s.error)}catch(s){i("Failed to close deal as won. Please try again.")}})(e.id),className:"text-emerald-600 hover:text-emerald-900 p-2 hover:bg-emerald-50 rounded-md transition duration-200",title:"Close as Won (Creates Customer)",children:f.jsx(te,{className:"h-4 w-4"})}),f.jsx("button",{onClick:()=>(async e=>{const s=prompt("Please provide a reason for closing as lost:");if(s)try{const t=await Re.closeDeal(e,{status:"closed_lost",notes:`Deal closed as lost - Reason: ${s}`});t.success?(await w(),i("")):i(t.error)}catch(t){i("Failed to close deal as lost. Please try again.")}})(e.id),className:"text-gray-600 hover:text-gray-900 p-2 hover:bg-gray-50 rounded-md transition duration-200",title:"Close as Lost",children:f.jsx(ne,{className:"h-4 w-4"})})]}),f.jsx("button",{onClick:()=>(e=>{var s;u(e),j({title:e.title||"",lead_id:e.lead_id||"",notes:e.notes||"",status:e.status||"waiting_approval"}),N((null==(s=e.items)?void 0:s.map(e=>({id:e.id,product_id:e.product_id,quantity:e.quantity,unit_price:parseFloat(e.unit_price),negotiated_price:parseFloat(e.negotiated_price),discount_percentage:parseFloat(e.discount_percentage||0)})))||[{product_id:"",quantity:1,unit_price:0,negotiated_price:0,discount_percentage:0}]),m(!0)})(e),className:"text-indigo-600 hover:text-indigo-900 p-2 hover:bg-indigo-50 rounded-md transition duration-200",children:f.jsx(G,{className:"h-4 w-4"})}),"manager"===(null==s?void 0:s.role)&&f.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this deal?"))try{const s=await Re.deleteDeal(e);s.success?(await w(),i("")):i(s.error)}catch(s){i("Failed to delete deal. Please try again.")}})(e.id),className:"text-red-600 hover:text-red-900 p-2 hover:bg-red-50 rounded-md transition duration-200",children:f.jsx(ee,{className:"h-4 w-4"})})]})]}),f.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[f.jsxs("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:["Deal Items (",(null==(a=e.items)?void 0:a.length)||0,")"]}),f.jsx("div",{className:"space-y-2",children:(e.items||[]).map(e=>{var s;return f.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-md shadow-sm",children:[f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("span",{className:"font-medium text-gray-900",children:(null==(s=e.product)?void 0:s.name)||"Unknown Product"}),e.discount_percentage>0&&f.jsxs("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800",children:[e.discount_percentage,"% discount"]}),f.jsxs("span",{className:"text-xs text-gray-500",children:["Qty: ",e.quantity]})]}),e.unit_price!==e.negotiated_price&&f.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Original: ",k(e.unit_price)," → Negotiated: ",k(e.negotiated_price)]})]}),f.jsxs("div",{className:"text-right",children:[f.jsx("div",{className:"font-medium text-gray-900",children:k(e.subtotal)}),e.unit_price!==e.negotiated_price&&f.jsxs("div",{className:"text-xs text-red-600",children:["-",k((e.unit_price-e.negotiated_price)*e.quantity)]})]})]},e.id)})})]})]},e.id)})})]}),o&&f.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:f.jsx("div",{className:"relative top-10 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white",children:f.jsxs("div",{className:"mt-3",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900",children:x?"Edit Deal":"Create New Deal"}),f.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:f.jsx(ie,{className:"h-6 w-6"})})]}),f.jsxs("form",{onSubmit:async e=>{e.preventDefault(),l(!0);try{const e={...v,items:b.filter(e=>e.product_id&&e.quantity>0)};let s;s=x?await Re.updateDeal(x.id,e):await Re.createDeal(e),s.success?(await w(),m(!1),i("")):i(s.error)}catch(s){i("Failed to save deal. Please try again.")}finally{l(!1)}},className:"space-y-6",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Deal Title *"}),f.jsx("input",{type:"text",value:v.title,onChange:e=>j({...v,title:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Enter deal title (e.g., Internet Package Deal for ABC Corp)",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Lead/Customer"}),f.jsxs("select",{value:v.lead_id,onChange:e=>j({...v,lead_id:e.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0,children:[f.jsx("option",{value:"",children:"Select a lead"}),p.map(e=>f.jsxs("option",{value:e.id,children:[e.name," - ",e.email]},e.id))]})]}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex justify-between items-center mb-3",children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Deal Items"}),f.jsxs("button",{type:"button",onClick:()=>{N([...b,{product_id:"",quantity:1,unit_price:0,negotiated_price:0,discount_percentage:0}])},className:"px-3 py-1 bg-indigo-600 text-white text-sm rounded-md hover:bg-indigo-700 flex items-center",children:[f.jsx(Z,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),f.jsx("div",{className:"space-y-3",children:b.map((e,s)=>f.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Product"}),f.jsxs("select",{value:e.product_id,onChange:e=>P(s,"product_id",e.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0,children:[f.jsx("option",{value:"",children:"Select product"}),h.map(e=>f.jsxs("option",{value:e.id,children:[e.name," - ",k(e.selling_price)]},e.id))]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Quantity"}),f.jsx("input",{type:"number",value:e.quantity,onChange:e=>P(s,"quantity",parseInt(e.target.value)),min:"1",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Unit Price"}),f.jsx("input",{type:"number",value:e.unit_price,onChange:e=>P(s,"unit_price",parseFloat(e.target.value)),step:"0.01",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Discount %"}),f.jsx("input",{type:"number",value:e.discount_percentage,onChange:e=>P(s,"discount_percentage",parseFloat(e.target.value)),min:"0",max:"100",step:"0.01",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Negotiated Price"}),f.jsx("input",{type:"number",value:e.negotiated_price,onChange:e=>P(s,"negotiated_price",parseFloat(e.target.value)),step:"0.01",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),f.jsx("div",{className:"flex items-end",children:b.length>1&&f.jsxs("button",{type:"button",onClick:()=>(e=>{b.length>1&&N(b.filter((s,t)=>t!==e))})(s),className:"px-3 py-2 bg-red-600 text-white text-sm rounded-md hover:bg-red-700 flex items-center",children:[f.jsx(ee,{className:"h-4 w-4 mr-1"}),"Remove"]})})]}),f.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:f.jsx("div",{className:"text-right",children:f.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Subtotal: ",k(e.negotiated_price*e.quantity)]})})})]},s))})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),f.jsx("textarea",{value:v.notes,onChange:e=>j({...v,notes:e.target.value}),rows:3,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Additional notes for this deal..."})]}),f.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Total Deal Value:"}),f.jsx("span",{className:"text-xl font-bold text-green-600",children:k(b.reduce((e,s)=>e+s.negotiated_price*s.quantity,0))})]})}),f.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[f.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"}),f.jsx("button",{type:"submit",disabled:r,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 flex items-center",children:r?f.jsxs(f.Fragment,{children:[f.jsx(ce,{size:"sm"}),f.jsx("span",{className:"ml-2",children:"Saving..."})]}):f.jsxs(f.Fragment,{children:[f.jsx(J,{className:"h-4 w-4 mr-2"}),x?"Update Deal":"Create Deal"]})})]})]})]})})})]})},Ae=()=>{var s;const{user:t}=C(),[a,r]=e.useState([]),[l,n]=e.useState(!0),[i,d]=e.useState(""),[c,o]=e.useState("month"),[m,x]=e.useState({start:new Date((new Date).getFullYear(),(new Date).getMonth(),1).toISOString().split("T")[0],end:(new Date).toISOString().split("T")[0]}),[u,h]=e.useState(null);e.useEffect(()=>{const e=new Date;let s,t;switch(c){case"week":const a=new Date(e);a.setDate(e.getDate()-e.getDay());const r=new Date(a);r.setDate(a.getDate()+6),s=a,t=r;break;case"quarter":const l=new Date(e.getFullYear(),3*Math.floor(e.getMonth()/3),1),n=new Date(l.getFullYear(),l.getMonth()+3,0);s=l,t=n;break;case"year":s=new Date(e.getFullYear(),0,1),t=new Date(e.getFullYear(),11,31);break;default:s=new Date(e.getFullYear(),e.getMonth(),1),t=new Date(e.getFullYear(),e.getMonth()+1,0)}x({start:s.toISOString().split("T")[0],end:t.toISOString().split("T")[0]})},[c]),e.useEffect(()=>{g(),p()},[c,m]);const g=async()=>{n(!0);try{const e=await pe();e.success?(r(e.data),d("")):d(e.error)}catch(e){d("Failed to load reports. Please try again.")}finally{n(!1)}},p=async()=>{try{const e=await me(c,{start:m.start,end:m.end});e.success?(h(e.data),d("")):d(e.error)}catch(e){d("Failed to load statistics. Please try again.")}},y=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),v=async e=>{try{const s=await he(e,{startDate:m.start,endDate:m.end});s.success?d(""):d(s.error)}catch(s){d("Failed to export report. Please try again.")}},j=async e=>{n(!0);try{let s;switch(e){case"sales":s=await xe(m);break;case"revenue":s=await ue(m);break;case"customer":s=await ge(m);break;default:return void d("Unknown report type")}s.success?(d(""),g()):d(s.error)}catch(s){d("Failed to generate report. Please try again.")}finally{n(!1)}};return"sales"!==(null==t?void 0:t.role)||(null==(s=null==t?void 0:t.permissions)?void 0:s.can_view_reports)?f.jsxs("div",{className:"max-w-7xl mx-auto py-8",children:[f.jsxs("div",{className:"mb-8",children:[f.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[f.jsx(A,{className:"h-8 w-8 mr-3 text-indigo-600"}),"Reports & Analytics"]}),f.jsx("p",{className:"mt-2 text-gray-600",children:"manager"===(null==t?void 0:t.role)?"Comprehensive business intelligence and performance reports":"Your sales performance and assigned reports"})]}),i&&f.jsx("div",{className:"mb-6",children:f.jsx(oe,{message:i,onClose:()=>d("")})}),f.jsx("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:f.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[f.jsxs("div",{className:"mb-4 sm:mb-0",children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Report Period"}),f.jsx("p",{className:"text-sm text-gray-500",children:"Select date range for reports"})]}),f.jsxs("div",{className:"flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4",children:[f.jsx("div",{className:"flex space-x-2",children:[{key:"week",label:"This Week"},{key:"month",label:"This Month"},{key:"quarter",label:"This Quarter"},{key:"year",label:"This Year"}].map(e=>f.jsx("button",{onClick:()=>o(e.key),className:"px-3 py-2 text-sm font-medium rounded-md "+(c===e.key?"bg-indigo-100 text-indigo-700":"text-gray-700 hover:text-gray-900 hover:bg-gray-100"),children:e.label},e.key))}),f.jsxs("div",{className:"flex space-x-2",children:[f.jsx("input",{type:"date",value:m.start,onChange:e=>x({...m,start:e.target.value}),className:"border border-gray-300 rounded-md px-3 py-2 text-sm"}),f.jsx("input",{type:"date",value:m.end,onChange:e=>x({...m,end:e.target.value}),className:"border border-gray-300 rounded-md px-3 py-2 text-sm"})]})]})]})}),u&&f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[f.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:f.jsx("div",{className:"p-5",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx($,{className:"h-6 w-6 text-green-400"})}),f.jsx("div",{className:"ml-5 w-0 flex-1",children:f.jsxs("dl",{children:[f.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"sales"===(null==t?void 0:t.role)?"My Total Revenue":"Total Revenue"}),f.jsx("dd",{className:"text-lg font-medium text-gray-900",children:y(u.totalRevenue||0)})]})})]})})}),f.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:f.jsx("div",{className:"p-5",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx(re,{className:"h-6 w-6 text-blue-400"})}),f.jsx("div",{className:"ml-5 w-0 flex-1",children:f.jsxs("dl",{children:[f.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"sales"===(null==t?void 0:t.role)?"My Customers":"Total Customers"}),f.jsx("dd",{className:"text-lg font-medium text-gray-900",children:u.totalCustomers||0})]})})]})})}),f.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:f.jsx("div",{className:"p-5",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx(le,{className:"h-6 w-6 text-purple-400"})}),f.jsx("div",{className:"ml-5 w-0 flex-1",children:f.jsxs("dl",{children:[f.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Active Services"}),f.jsx("dd",{className:"text-lg font-medium text-gray-900",children:u.activeServices||0})]})})]})})}),f.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:f.jsx("div",{className:"p-5",children:f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx(se,{className:"h-6 w-6 text-orange-400"})}),f.jsx("div",{className:"ml-5 w-0 flex-1",children:f.jsxs("dl",{children:[f.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Conversion Rate"}),f.jsxs("dd",{className:"text-lg font-medium text-gray-900",children:[u.conversionRate||0,"%"]})]})})]})})})]}),u&&f.jsxs("div",{className:"bg-white shadow rounded-lg p-6 mb-8",children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"sales"===(null==t?void 0:t.role)?"My Performance Indicators":"Key Performance Indicators"}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:y(u.avgDealValue||0)}),f.jsx("div",{className:"text-sm text-gray-500",children:"Average Deal Value"})]}),f.jsxs("div",{className:"text-center",children:[f.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[u.monthlyGrowth||0,"%"]}),f.jsx("div",{className:"text-sm text-gray-500",children:"Monthly Growth"})]}),f.jsxs("div",{className:"text-center",children:[f.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[u.customerRetention||0,"%"]}),f.jsx("div",{className:"text-sm text-gray-500",children:"Customer Retention"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-purple-600",children:u.newLeads||0}),f.jsx("div",{className:"text-sm text-gray-500",children:"sales"===(null==t?void 0:t.role)?"My New Leads":"New Leads This Month"})]})]})]}),"manager"===(null==t?void 0:t.role)&&f.jsxs("div",{className:"bg-white shadow rounded-lg p-6 mb-8",children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Generate New Report"}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[f.jsx("button",{onClick:()=>j("sales"),className:"flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:f.jsxs("div",{className:"text-center",children:[f.jsx(se,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),f.jsx("span",{className:"block text-sm font-medium text-gray-900",children:"Sales Report"})]})}),f.jsx("button",{onClick:()=>j("revenue"),className:"flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:f.jsxs("div",{className:"text-center",children:[f.jsx($,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),f.jsx("span",{className:"block text-sm font-medium text-gray-900",children:"Revenue Report"})]})}),f.jsx("button",{onClick:()=>j("customer"),className:"flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:f.jsxs("div",{className:"text-center",children:[f.jsx(re,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),f.jsx("span",{className:"block text-sm font-medium text-gray-900",children:"Customer Report"})]})})]})]}),f.jsxs("div",{className:"bg-white shadow rounded-lg p-6 mb-8",children:[f.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:[f.jsx(U,{className:"inline h-5 w-5 mr-2 text-green-600"}),"Export to Excel"]}),f.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Download reports directly as Excel files for the selected date range."}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[f.jsx("button",{onClick:()=>v("leads"),className:"flex items-center justify-center p-4 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500",children:f.jsxs("div",{className:"text-center",children:[f.jsx(re,{className:"mx-auto h-6 w-6 text-blue-600 mb-2"}),f.jsx("span",{className:"block text-sm font-medium text-blue-900",children:"Leads Report"}),f.jsx("span",{className:"block text-xs text-blue-600",children:"Excel Export"})]})}),f.jsx("button",{onClick:()=>v("deals"),className:"flex items-center justify-center p-4 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-green-500",children:f.jsxs("div",{className:"text-center",children:[f.jsx(se,{className:"mx-auto h-6 w-6 text-green-600 mb-2"}),f.jsx("span",{className:"block text-sm font-medium text-green-900",children:"Deals Report"}),f.jsx("span",{className:"block text-xs text-green-600",children:"Excel Export"})]})}),f.jsx("button",{onClick:()=>v("customers"),className:"flex items-center justify-center p-4 bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100 focus:outline-none focus:ring-2 focus:ring-purple-500",children:f.jsxs("div",{className:"text-center",children:[f.jsx(re,{className:"mx-auto h-6 w-6 text-purple-600 mb-2"}),f.jsx("span",{className:"block text-sm font-medium text-purple-900",children:"Customers Report"}),f.jsx("span",{className:"block text-xs text-purple-600",children:"Excel Export"})]})}),f.jsx("button",{onClick:()=>v("sales"),className:"flex items-center justify-center p-4 bg-orange-50 border border-orange-200 rounded-lg hover:bg-orange-100 focus:outline-none focus:ring-2 focus:ring-orange-500",children:f.jsxs("div",{className:"text-center",children:[f.jsx(A,{className:"mx-auto h-6 w-6 text-orange-600 mb-2"}),f.jsx("span",{className:"block text-sm font-medium text-orange-900",children:"Sales Report"}),f.jsx("span",{className:"block text-xs text-orange-600",children:"Excel Export"})]})})]})]}),l?f.jsx("div",{className:"text-center py-12",children:f.jsx(ce,{size:"lg",text:"Loading reports..."})}):f.jsxs("div",{className:"bg-white shadow-lg rounded-lg overflow-hidden",children:[f.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:f.jsx("div",{className:"flex justify-between items-center",children:f.jsxs("div",{children:[f.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:["sales"===(null==t?void 0:t.role)?"My Reports":"Generated Reports"," (",a.length,")"]}),f.jsx("p",{className:"text-sm text-gray-600",children:"manager"===(null==t?void 0:t.role)?"All system generated reports":"Reports available to you"})]})})}),0===a.length?f.jsxs("div",{className:"p-12 text-center text-gray-500",children:[f.jsx(O,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),f.jsx("p",{className:"text-lg",children:"No reports available"}),f.jsx("p",{className:"text-sm",children:"manager"===(null==t?void 0:t.role)?"Generate your first report above":"No reports have been shared with you yet"})]}):f.jsx("div",{className:"divide-y divide-gray-200",children:a.map(e=>{return f.jsx("div",{className:"p-6 hover:bg-gray-50 transition duration-200",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("div",{className:"flex-1",children:f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(O,{className:"h-5 w-5 text-gray-400"}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900",children:e.title||"Untitled Report"}),f.jsx("p",{className:"text-sm text-gray-600",children:e.description||"No description"}),f.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[f.jsxs("span",{children:["Generated: ",(s=e.generated_at||e.created_at,new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))]}),e.file_size&&f.jsxs("span",{children:["Size: ",e.file_size]}),f.jsxs("span",{className:"capitalize",children:["Type: ",e.type||"General"]})]})]})]})}),f.jsx("div",{className:"flex items-center space-x-2",children:f.jsxs("button",{onClick:()=>v(e.type),className:"flex items-center px-3 py-2 text-sm font-medium text-indigo-600 bg-indigo-100 rounded-md hover:bg-indigo-200 transition duration-200",children:[f.jsx(U,{className:"h-4 w-4 mr-1"}),"Download Excel"]})})]})},e.id);var s})})]})]}):f.jsx("div",{className:"max-w-7xl mx-auto py-8",children:f.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4",children:f.jsx("div",{className:"flex",children:f.jsx("div",{className:"ml-3",children:f.jsx("p",{className:"text-sm text-yellow-700",children:"You don't have permission to view reports. Please contact your manager."})})})})})};function Ie(){return f.jsx(S,{children:f.jsx("div",{className:"App",children:f.jsxs(i,{children:[f.jsx(d,{path:"/",element:f.jsx(de,{})}),f.jsx(d,{path:"/login",element:f.jsx(de,{})}),f.jsx(d,{path:"/dashboard",element:f.jsx(P,{children:f.jsx(M,{children:f.jsx(ye,{})})})}),f.jsx(d,{path:"/leads",element:f.jsx(P,{children:f.jsx(M,{children:f.jsx(_e,{})})})}),f.jsx(d,{path:"/deals",element:f.jsx(P,{children:f.jsx(M,{children:f.jsx(ze,{})})})}),f.jsx(d,{path:"/products",element:f.jsx(P,{children:f.jsx(M,{children:f.jsx(je,{})})})}),f.jsx(d,{path:"/customers",element:f.jsx(P,{children:f.jsx(M,{children:f.jsx(Fe,{})})})}),f.jsx(d,{path:"/reports",element:f.jsx(P,{children:f.jsx(M,{children:f.jsx(Ae,{})})})})]})})})}b.createRoot(document.getElementById("root")).render(f.jsx(t.StrictMode,{children:f.jsx(c,{children:f.jsx(Ie,{})})}));
